{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—ç–∫–∞–ø–∞–º–∏ - CtrlMoney{% endblock %}

{% block extrahead %}
<style>
    .backup-container {
        max-width: 1000px;
        margin: 20px auto;
        padding: 20px;
        background-color: #f9f9f9;
        border-radius: 8px;
    }
    
    .backup-section {
        margin: 20px 0;
        padding: 20px;
        background-color: white;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    
    .backup-section h2 {
        margin-top: 0;
        color: #333;
        border-bottom: 2px solid #417690;
        padding-bottom: 10px;
    }
    
    .backup-button {
        display: inline-block;
        padding: 10px 20px;
        margin: 5px;
        background-color: #417690;
        color: white;
        text-decoration: none;
        border-radius: 4px;
        cursor: pointer;
        border: none;
        font-size: 14px;
    }
    
    .backup-button:hover {
        background-color: #205067;
    }
    
    .backup-button.danger {
        background-color: #ba2121;
    }
    
    .backup-button.danger:hover {
        background-color: #8b1818;
    }
    
    .users-list {
        list-style: none;
        padding: 0;
    }
    
    .users-list li {
        padding: 10px;
        margin: 5px 0;
        background-color: #f5f5f5;
        border-left: 4px solid #417690;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .user-info {
        flex: 1;
    }
    
    .user-info strong {
        display: block;
        margin-bottom: 3px;
    }
    
    .user-info small {
        color: #666;
    }
    
    .backup-info {
        background-color: #e8f4f8;
        padding: 15px;
        border-left: 4px solid #417690;
        margin: 15px 0;
        border-radius: 4px;
    }
    
    .backup-info h3 {
        margin-top: 0;
        color: #205067;
    }
    
    .backup-info p {
        margin: 5px 0;
        line-height: 1.6;
    }
    
    .loading {
        display: inline-block;
        opacity: 0.5;
    }
</style>
{% endblock %}

{% block content %}
<div class="backup-container">
    <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—ç–∫–∞–ø–∞–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</h1>
    
    <!-- –†–∞–∑–¥–µ–ª –ø–æ–ª–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞ -->
    <div class="backup-section">
        <h2>–ü–æ–ª–Ω—ã–π –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</h2>
        
        <div class="backup-info">
            <h3>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <p>–°–∫–∞—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π SQL –±—ç–∫–∞–ø –≤—Å–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –≤–∫–ª—é—á–∞—è:</p>
            <ul>
                <li>–í—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</li>
                <li>–ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</li>
                <li>–°—á–µ—Ç–∞</li>
                <li>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</li>
                <li>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ü–µ–ª–∏</li>
                <li>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—é–¥–∂–µ—Ç–∞</li>
            </ul>
            <p><strong>–§–æ—Ä–º–∞—Ç:</strong> SQL INSERT –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</p>
        </div>
        
        <form action="/admin/backup/full/" method="get" style="display: inline;">
            <button type="submit" class="backup-button">
                üì• –°–∫–∞—á–∞—Ç—å –ø–æ–ª–Ω—ã–π –±—ç–∫–∞–ø (SQL)
            </button>
        </form>
    </div>
    
    <!-- –†–∞–∑–¥–µ–ª –±—ç–∫–∞–ø–æ–≤ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º -->
    <div class="backup-section">
        <h2>–ë—ç–∫–∞–ø—ã –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</h2>
        
        <div class="backup-info">
            <h3>üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <p>–°–∫–∞—á–∏–≤–∞–µ—Ç SQL –±—ç–∫–∞–ø –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</p>
            <ul>
                <li>–î–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è</li>
                <li>–õ–∏—á–Ω—ã–µ —Å—á–µ—Ç–∞</li>
                <li>–õ–∏—á–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</li>
                <li>–õ–∏—á–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ü–µ–ª–∏</li>
                <li>–õ–∏—á–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—é–¥–∂–µ—Ç–∞</li>
            </ul>
            <p><strong>–§–æ—Ä–º–∞—Ç:</strong> SQL INSERT –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</p>
        </div>
        
        {% if users %}
            <ul class="users-list">
                {% for user in users %}
                    <li>
                        <div class="user-info">
                            <strong>{{ user.username }}</strong>
                            <small>Email: {{ user.email }}</small>
                            <small>–î–∞—Ç–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: {{ user.date_joined|date:"d.m.Y" }}</small>
                        </div>
                        <form action="/admin/backup/user/{{ user.id }}/" method="get" style="margin: 0;">
                            <button type="submit" class="backup-button">
                                üì• –°–∫–∞—á–∞—Ç—å –±—ç–∫–∞–ø
                            </button>
                        </form>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p style="color: #666;">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ</p>
        {% endif %}
    </div>
    
    <!-- –†–∞–∑–¥–µ–ª –∏–º–ø–æ—Ä—Ç–∞ JSON -->
    <div class="backup-section">
        <h2>–ò–º–ø–æ—Ä—Ç JSON –¥–∞–Ω–Ω—ã—Ö</h2>
        
        <div class="backup-info">
            <h3>üì§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ JSON —Ñ–∞–π–ª —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:</p>
            <pre style="background-color: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto;">
{
  "accounts": [
    {"name": "...", "amount": 1000, "account_type": "debit", "description": "..."}
  ],
  "transactions": [
    {"name": "...", "amount": 100, "transaction_type": "expense", "category": "–µ–¥–∞", "date": "2023-01-01T10:00:00"}
  ],
  "goals": [
    {"name": "...", "target_amount": 50000, "current_amount": 10000}
  ],
  "budget_categories": [
    {"name": "–µ–¥–∞", "budget": 5000, "emoji": "üçî"}
  ]
}</pre>
        </div>
        
        <div style="margin: 20px 0;">
            <p><strong>–î–ª—è –∏–º–ø–æ—Ä—Ç–∞ JSON –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ API endpoint:</strong></p>
            <code style="background-color: #f5f5f5; padding: 5px; border-radius: 3px;">
                POST /api/import-json/
            </code>
            <p style="color: #666; font-size: 12px;">
                –û—Ç–ø—Ä–∞–≤—å—Ç–µ multipart/form-data –∑–∞–ø—Ä–æ—Å —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º <code>json_file</code> —Å–æ–¥–µ—Ä–∂–∞—â–∏–º JSON —Ñ–∞–π–ª
            </p>
        </div>
    </div>
    
    <div class="backup-info" style="margin-top: 30px;">
        <h3>‚ö†Ô∏è –í–∞–∂–Ω–æ–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ</h3>
        <p>
            –í—Å–µ –±—ç–∫–∞–ø—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∫–ª—é—á–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (–ø–∞—Ä–æ–ª–∏ –≤ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ).
            –•—Ä–∞–Ω–∏—Ç–µ –±—ç–∫–∞–ø—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –±—ç–∫–∞–ø—ã –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ —Å–ª—É—á–∞–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
        </p>
    </div>
</div>
{% endblock %}
